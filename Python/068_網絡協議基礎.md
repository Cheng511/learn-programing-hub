[ä¸Šä¸€ç« ï¼šSocketç·¨ç¨‹é€²éš](067_Socketç·¨ç¨‹é€²éš.md) | [ä¸‹ä¸€ç« ï¼šç¶²çµ¡å”è­°é€²éš](069_ç¶²çµ¡å”è­°é€²éš.md)

# Python ç¶²çµ¡å”è­°åŸºç¤ ğŸŒ

## ç¶²çµ¡å”è­°æ¦‚è¿°

ç¶²çµ¡å”è­°æ˜¯è¨ˆç®—æ©Ÿç¶²çµ¡ä¸­é€²è¡Œé€šä¿¡çš„è¦å‰‡å’Œæ¨™æº–ã€‚Pythonæä¾›äº†è±å¯Œçš„åº«ä¾†è™•ç†å„ç¨®ç¶²çµ¡å”è­°ã€‚

### 1. å”è­°å±¤æ¬¡

```python
# OSIä¸ƒå±¤æ¨¡å‹
osi_layers = {
    7: "æ‡‰ç”¨å±¤ (Application)",
    6: "è¡¨ç¤ºå±¤ (Presentation)",
    5: "æœƒè©±å±¤ (Session)",
    4: "å‚³è¼¸å±¤ (Transport)",
    3: "ç¶²çµ¡å±¤ (Network)",
    2: "æ•¸æ“šéˆè·¯å±¤ (Data Link)",
    1: "ç‰©ç†å±¤ (Physical)"
}

# TCP/IPå››å±¤æ¨¡å‹
tcpip_layers = {
    4: "æ‡‰ç”¨å±¤ (Application)",
    3: "å‚³è¼¸å±¤ (Transport)",
    2: "ç¶²çµ¡å±¤ (Internet)",
    1: "ç¶²çµ¡æ¥å£å±¤ (Network Interface)"
}

# æ‰“å°å”è­°å±¤æ¬¡
print("OSIä¸ƒå±¤æ¨¡å‹:")
for layer_num, layer_name in sorted(osi_layers.items()):
    print(f"{layer_num}. {layer_name}")

print("\nTCP/IPå››å±¤æ¨¡å‹:")
for layer_num, layer_name in sorted(tcpip_layers.items()):
    print(f"{layer_num}. {layer_name}")
```

### 2. å¸¸è¦‹å”è­°

```python
# å¸¸è¦‹ç¶²çµ¡å”è­°
protocols = {
    "æ‡‰ç”¨å±¤": [
        "HTTP (è¶…æ–‡æœ¬å‚³è¼¸å”è­°)",
        "HTTPS (å®‰å…¨è¶…æ–‡æœ¬å‚³è¼¸å”è­°)",
        "FTP (æ–‡ä»¶å‚³è¼¸å”è­°)",
        "SMTP (ç°¡å–®éƒµä»¶å‚³è¼¸å”è­°)",
        "POP3 (éƒµå±€å”è­°)",
        "IMAP (äº’è¯ç¶²æ¶ˆæ¯è¨ªå•å”è­°)",
        "DNS (åŸŸåç³»çµ±)",
        "DHCP (å‹•æ…‹ä¸»æ©Ÿé…ç½®å”è­°)"
    ],
    "å‚³è¼¸å±¤": [
        "TCP (å‚³è¼¸æ§åˆ¶å”è­°)",
        "UDP (ç”¨æˆ¶æ•¸æ“šå ±å”è­°)"
    ],
    "ç¶²çµ¡å±¤": [
        "IP (äº’è¯ç¶²å”è­°)",
        "ICMP (äº’è¯ç¶²æ§åˆ¶æ¶ˆæ¯å”è­°)",
        "ARP (åœ°å€è§£æå”è­°)",
        "RARP (åå‘åœ°å€è§£æå”è­°)"
    ]
}

# æ‰“å°å”è­°ä¿¡æ¯
for layer, protocol_list in protocols.items():
    print(f"\n{layer}å”è­°:")
    for protocol in protocol_list:
        print(f"- {protocol}")
```

## HTTPå”è­°

### 1. HTTPå®¢æˆ¶ç«¯

```python
import http.client
from typing import Dict, Optional
import json

class HTTPClient:
    def __init__(self, host: str):
        self.host = host
        self.conn = http.client.HTTPConnection(host)
    
    def get(self, path: str = "/",
            headers: Optional[Dict[str, str]] = None) -> Optional[Dict]:
        """ç™¼é€GETè«‹æ±‚"""
        try:
            # ç™¼é€è«‹æ±‚
            self.conn.request("GET", path, headers=headers)
            
            # ç²å–éŸ¿æ‡‰
            response = self.conn.getresponse()
            
            # è®€å–éŸ¿æ‡‰å…§å®¹
            data = response.read()
            
            return {
                'status': response.status,
                'reason': response.reason,
                'headers': dict(response.getheaders()),
                'body': data.decode('utf-8')
            }
        
        except Exception as e:
            print(f"Error making GET request: {e}")
            return None
    
    def post(self, path: str = "/",
             data: Optional[Dict] = None,
             headers: Optional[Dict[str, str]] = None) -> Optional[Dict]:
        """ç™¼é€POSTè«‹æ±‚"""
        try:
            # æº–å‚™è«‹æ±‚æ•¸æ“š
            body = json.dumps(data) if data else None
            if body:
                headers = headers or {}
                headers['Content-Type'] = 'application/json'
            
            # ç™¼é€è«‹æ±‚
            self.conn.request("POST", path, body=body, headers=headers)
            
            # ç²å–éŸ¿æ‡‰
            response = self.conn.getresponse()
            
            # è®€å–éŸ¿æ‡‰å…§å®¹
            data = response.read()
            
            return {
                'status': response.status,
                'reason': response.reason,
                'headers': dict(response.getheaders()),
                'body': data.decode('utf-8')
            }
        
        except Exception as e:
            print(f"Error making POST request: {e}")
            return None
    
    def close(self):
        """é—œé–‰é€£æ¥"""
        self.conn.close()

# ä½¿ç”¨ç¤ºä¾‹
def main():
    # å‰µå»ºå®¢æˆ¶ç«¯
    client = HTTPClient("example.com")
    
    try:
        # ç™¼é€GETè«‹æ±‚
        print("Sending GET request...")
        response = client.get("/")
        if response:
            print(f"Status: {response['status']}")
            print(f"Headers: {response['headers']}")
            print(f"Body: {response['body'][:200]}...")
        
        # ç™¼é€POSTè«‹æ±‚
        print("\nSending POST request...")
        data = {"name": "John", "age": 30}
        response = client.post("/api/users", data=data)
        if response:
            print(f"Status: {response['status']}")
            print(f"Headers: {response['headers']}")
            print(f"Body: {response['body']}")
    
    finally:
        client.close()

if __name__ == '__main__':
    main()
```

### 2. HTTPæœå‹™å™¨

```python
from http.server import HTTPServer, BaseHTTPRequestHandler
import json
from typing import Dict, Any
import urllib.parse

class RequestHandler(BaseHTTPRequestHandler):
    def do_GET(self):
        """è™•ç†GETè«‹æ±‚"""
        try:
            # è§£æURLå’ŒæŸ¥è©¢åƒæ•¸
            parsed_path = urllib.parse.urlparse(self.path)
            
            # æ ¹æ“šè·¯å¾‘è™•ç†è«‹æ±‚
            if parsed_path.path == '/':
                self.handle_root()
            elif parsed_path.path == '/api/users':
                self.handle_get_users()
            else:
                self.handle_not_found()
        
        except Exception as e:
            self.handle_error(e)
    
    def do_POST(self):
        """è™•ç†POSTè«‹æ±‚"""
        try:
            # è®€å–è«‹æ±‚å…§å®¹
            content_length = int(self.headers['Content-Length'])
            post_data = self.rfile.read(content_length)
            data = json.loads(post_data.decode('utf-8'))
            
            # æ ¹æ“šè·¯å¾‘è™•ç†è«‹æ±‚
            if self.path == '/api/users':
                self.handle_create_user(data)
            else:
                self.handle_not_found()
        
        except Exception as e:
            self.handle_error(e)
    
    def handle_root(self):
        """è™•ç†æ ¹è·¯å¾‘è«‹æ±‚"""
        self.send_response(200)
        self.send_header('Content-type', 'text/html')
        self.end_headers()
        self.wfile.write(b"Welcome to the API server!")
    
    def handle_get_users(self):
        """è™•ç†ç²å–ç”¨æˆ¶åˆ—è¡¨è«‹æ±‚"""
        # æ¨¡æ“¬æ•¸æ“šåº«
        users = [
            {"id": 1, "name": "John"},
            {"id": 2, "name": "Alice"}
        ]
        
        self.send_response(200)
        self.send_header('Content-type', 'application/json')
        self.end_headers()
        self.wfile.write(json.dumps(users).encode('utf-8'))
    
    def handle_create_user(self, data: Dict[str, Any]):
        """è™•ç†å‰µå»ºç”¨æˆ¶è«‹æ±‚"""
        # æ¨¡æ“¬æ•¸æ“šåº«æ“ä½œ
        user_id = 3  # æ¨¡æ“¬æ–°ç”¨æˆ¶ID
        response = {
            "id": user_id,
            "name": data.get("name"),
            "message": "User created successfully"
        }
        
        self.send_response(201)
        self.send_header('Content-type', 'application/json')
        self.end_headers()
        self.wfile.write(json.dumps(response).encode('utf-8'))
    
    def handle_not_found(self):
        """è™•ç†404éŒ¯èª¤"""
        self.send_response(404)
        self.send_header('Content-type', 'application/json')
        self.end_headers()
        self.wfile.write(json.dumps({
            "error": "Not Found"
        }).encode('utf-8'))
    
    def handle_error(self, error: Exception):
        """è™•ç†500éŒ¯èª¤"""
        self.send_response(500)
        self.send_header('Content-type', 'application/json')
        self.end_headers()
        self.wfile.write(json.dumps({
            "error": str(error)
        }).encode('utf-8'))

# ä½¿ç”¨ç¤ºä¾‹
def run_server(host: str = 'localhost',
              port: int = 8000):
    """é‹è¡ŒHTTPæœå‹™å™¨"""
    server_address = (host, port)
    httpd = HTTPServer(server_address, RequestHandler)
    print(f"Server running on {host}:{port}")
    httpd.serve_forever()

if __name__ == '__main__':
    run_server()
```

## FTPå”è­°

### 1. FTPå®¢æˆ¶ç«¯

```python
from ftplib import FTP
from typing import List, Optional
import os

class FTPClient:
    def __init__(self, host: str,
                 user: str = '',
                 password: str = ''):
        self.host = host
        self.user = user
        self.password = password
        self.ftp: Optional[FTP] = None
    
    def connect(self) -> bool:
        """é€£æ¥åˆ°FTPæœå‹™å™¨"""
        try:
            self.ftp = FTP(self.host)
            self.ftp.login(self.user, self.password)
            print(f"Connected to {self.host}")
            return True
        except Exception as e:
            print(f"Connection failed: {e}")
            return False
    
    def list_directory(self, path: str = '.') -> List[str]:
        """åˆ—å‡ºç›®éŒ„å…§å®¹"""
        if not self.ftp:
            raise RuntimeError("Not connected")
        
        try:
            return self.ftp.nlst(path)
        except Exception as e:
            print(f"Error listing directory: {e}")
            return []
    
    def download_file(self, remote_path: str,
                     local_path: str) -> bool:
        """ä¸‹è¼‰æ–‡ä»¶"""
        if not self.ftp:
            raise RuntimeError("Not connected")
        
        try:
            with open(local_path, 'wb') as f:
                self.ftp.retrbinary(f'RETR {remote_path}', f.write)
            return True
        except Exception as e:
            print(f"Error downloading file: {e}")
            return False
    
    def upload_file(self, local_path: str,
                   remote_path: str) -> bool:
        """ä¸Šå‚³æ–‡ä»¶"""
        if not self.ftp:
            raise RuntimeError("Not connected")
        
        try:
            with open(local_path, 'rb') as f:
                self.ftp.storbinary(f'STOR {remote_path}', f)
            return True
        except Exception as e:
            print(f"Error uploading file: {e}")
            return False
    
    def close(self):
        """é—œé–‰é€£æ¥"""
        if self.ftp:
            self.ftp.quit()

# ä½¿ç”¨ç¤ºä¾‹
def main():
    # å‰µå»ºFTPå®¢æˆ¶ç«¯
    client = FTPClient("ftp.example.com", "user", "password")
    
    try:
        # é€£æ¥åˆ°æœå‹™å™¨
        if client.connect():
            # åˆ—å‡ºç›®éŒ„
            print("\nDirectory listing:")
            files = client.list_directory()
            for file in files:
                print(f"- {file}")
            
            # ä¸‹è¼‰æ–‡ä»¶
            print("\nDownloading file...")
            if client.download_file("remote.txt", "local.txt"):
                print("File downloaded successfully")
            
            # ä¸Šå‚³æ–‡ä»¶
            print("\nUploading file...")
            if client.upload_file("local.txt", "remote_upload.txt"):
                print("File uploaded successfully")
    
    finally:
        client.close()

if __name__ == '__main__':
    main()
```

### 2. FTPæœå‹™å™¨

```python
from pyftpdlib.authorizers import DummyAuthorizer
from pyftpdlib.handlers import FTPHandler
from pyftpdlib.servers import FTPServer
import os

class FTPServer:
    def __init__(self, host: str = 'localhost',
                 port: int = 2121,
                 user: str = 'user',
                 password: str = 'password',
                 directory: str = './ftp_root'):
        self.host = host
        self.port = port
        self.user = user
        self.password = password
        self.directory = directory
        
        # å‰µå»ºFTPæ ¹ç›®éŒ„
        os.makedirs(directory, exist_ok=True)
    
    def start(self):
        """å•Ÿå‹•FTPæœå‹™å™¨"""
        try:
            # å‰µå»ºç”¨æˆ¶èªè­‰å™¨
            authorizer = DummyAuthorizer()
            authorizer.add_user(
                self.user,
                self.password,
                self.directory,
                perm='elradfmw'
            )
            
            # å‰µå»ºFTPè™•ç†å™¨
            handler = FTPHandler
            handler.authorizer = authorizer
            
            # å‰µå»ºFTPæœå‹™å™¨
            server = FTPServer(
                (self.host, self.port),
                handler
            )
            
            print(f"FTP server running on {self.host}:{self.port}")
            print(f"Root directory: {self.directory}")
            
            # å•Ÿå‹•æœå‹™å™¨
            server.serve_forever()
        
        except KeyboardInterrupt:
            print("\nServer shutting down...")
        
        except Exception as e:
            print(f"Error starting server: {e}")

# ä½¿ç”¨ç¤ºä¾‹
if __name__ == '__main__':
    server = FTPServer()
    server.start()
```

## ç·´ç¿’é¡Œ

1. **HTTPä»£ç†æœå‹™å™¨**
   å¯¦ç¾ä¸€å€‹HTTPä»£ç†æœå‹™å™¨ï¼š
   - æ”¯æŒGETå’ŒPOSTè«‹æ±‚
   - å¯¦ç¾ç·©å­˜æ©Ÿåˆ¶
   - æ·»åŠ è¨ªå•æ§åˆ¶
   - è¨˜éŒ„è¨ªå•æ—¥èªŒ

2. **FTPæ–‡ä»¶åŒæ­¥å™¨**
   é–‹ç™¼ä¸€å€‹FTPæ–‡ä»¶åŒæ­¥å·¥å…·ï¼š
   - ç›£æ§æœ¬åœ°ç›®éŒ„è®ŠåŒ–
   - è‡ªå‹•åŒæ­¥åˆ°FTPæœå‹™å™¨
   - æ”¯æŒå¢é‡æ›´æ–°
   - è™•ç†è¡çªæƒ…æ³

3. **å”è­°åˆ†æå™¨**
   å‰µå»ºä¸€å€‹ç¶²çµ¡å”è­°åˆ†æå·¥å…·ï¼š
   - æ•ç²ç¶²çµ¡æ•¸æ“šåŒ…
   - è§£æå”è­°é ­éƒ¨
   - çµ±è¨ˆæµé‡ä¿¡æ¯
   - ç”Ÿæˆåˆ†æå ±å‘Š

## å°æé†’ ğŸ’¡

1. å”è­°å¯¦ç¾
   - éµå¾ªå”è­°è¦ç¯„
   - è™•ç†ç•°å¸¸æƒ…æ³
   - å¯¦ç¾é‡è©¦æ©Ÿåˆ¶
   - å„ªåŒ–æ€§èƒ½

2. å®‰å…¨æ€§
   - ä½¿ç”¨åŠ å¯†å‚³è¼¸
   - é©—è­‰ç”¨æˆ¶èº«ä»½
   - æ§åˆ¶è¨ªå•æ¬Šé™
   - é˜²æ­¢æ”»æ“Š

3. å¯é æ€§
   - è™•ç†ç¶²çµ¡æ•…éšœ
   - å¯¦ç¾æ–·é»çºŒå‚³
   - æ ¡é©—æ•¸æ“šå®Œæ•´æ€§
   - å‚™ä»½é‡è¦æ•¸æ“š

4. èª¿è©¦æŠ€å·§
   - ä½¿ç”¨æŠ“åŒ…å·¥å…·
   - åˆ†æå”è­°æ—¥èªŒ
   - æ¨¡æ“¬ç¶²çµ¡ç’°å¢ƒ
   - å£“åŠ›æ¸¬è©¦

[ä¸Šä¸€ç« ï¼šSocketç·¨ç¨‹é€²éš](067_Socketç·¨ç¨‹é€²éš.md) | [ä¸‹ä¸€ç« ï¼šç¶²çµ¡å”è­°é€²éš](069_ç¶²çµ¡å”è­°é€²éš.md) 
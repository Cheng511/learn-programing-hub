[ä¸Šä¸€ç« ï¼šé€²ç¨‹ç·¨ç¨‹é€²éš](085_é€²ç¨‹ç·¨ç¨‹é€²éš.md) | [ä¸‹ä¸€ç« ï¼šç¶²çµ¡ç·¨ç¨‹é€²éš](087_ç¶²çµ¡ç·¨ç¨‹é€²éš.md)

# Python ç¶²çµ¡ç·¨ç¨‹åŸºç¤ ğŸŒ

## Socketç·¨ç¨‹

### 1. Socketæœå‹™å™¨

```python
import socket
import threading
import time
from typing import List, Dict, Any, Optional
import sys
import os

class SocketServer:
    def __init__(self, host: str = 'localhost', port: int = 5000):
        """åˆå§‹åŒ–Socketæœå‹™å™¨"""
        self.host = host
        self.port = port
        self.server_socket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        self.server_socket.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)
        self.clients: List[socket.socket] = []
        self.client_threads: List[threading.Thread] = []
        self.is_running = False
    
    def start(self):
        """å•Ÿå‹•æœå‹™å™¨"""
        try:
            self.server_socket.bind((self.host, self.port))
            self.server_socket.listen(5)
            self.is_running = True
            print(f"Server started on {self.host}:{self.port}")
            
            # å•Ÿå‹•æ¥å—é€£æ¥çš„ç·šç¨‹
            accept_thread = threading.Thread(target=self._accept_connections)
            accept_thread.daemon = True
            accept_thread.start()
            
        except Exception as e:
            print(f"Error starting server: {e}")
            self.stop()
    
    def stop(self):
        """åœæ­¢æœå‹™å™¨"""
        self.is_running = False
        for client in self.clients:
            try:
                client.close()
            except:
                pass
        
        try:
            self.server_socket.close()
        except:
            pass
        
        for thread in self.client_threads:
            thread.join()
    
    def _accept_connections(self):
        """æ¥å—å®¢æˆ¶ç«¯é€£æ¥"""
        while self.is_running:
            try:
                client_socket, address = self.server_socket.accept()
                print(f"New connection from {address}")
                
                # æ·»åŠ å®¢æˆ¶ç«¯
                self.clients.append(client_socket)
                
                # å•Ÿå‹•è™•ç†å®¢æˆ¶ç«¯çš„ç·šç¨‹
                client_thread = threading.Thread(
                    target=self._handle_client,
                    args=(client_socket, address)
                )
                client_thread.daemon = True
                client_thread.start()
                self.client_threads.append(client_thread)
            
            except socket.timeout:
                continue
            except Exception as e:
                print(f"Error accepting connection: {e}")
                break
    
    def _handle_client(self, client_socket: socket.socket, address: tuple):
        """è™•ç†å®¢æˆ¶ç«¯é€£æ¥"""
        try:
            while self.is_running:
                # æ¥æ”¶æ•¸æ“š
                data = client_socket.recv(1024)
                if not data:
                    break
                
                # è™•ç†æ•¸æ“š
                response = self._process_data(data)
                
                # ç™¼é€éŸ¿æ‡‰
                client_socket.send(response)
        
        except Exception as e:
            print(f"Error handling client {address}: {e}")
        
        finally:
            # æ¸…ç†å®¢æˆ¶ç«¯é€£æ¥
            self.clients.remove(client_socket)
            client_socket.close()
            print(f"Client {address} disconnected")
    
    def _process_data(self, data: bytes) -> bytes:
        """è™•ç†æ¥æ”¶åˆ°çš„æ•¸æ“š"""
        try:
            # è§£ç¢¼æ•¸æ“š
            message = data.decode('utf-8')
            print(f"Received: {message}")
            
            # è™•ç†æ¶ˆæ¯
            response = f"Server received: {message}"
            
            # ç·¨ç¢¼éŸ¿æ‡‰
            return response.encode('utf-8')
        
        except Exception as e:
            print(f"Error processing data: {e}")
            return b"Error processing data"
    
    def broadcast(self, message: str):
        """å»£æ’­æ¶ˆæ¯çµ¦æ‰€æœ‰å®¢æˆ¶ç«¯"""
        data = message.encode('utf-8')
        for client in self.clients[:]:  # ä½¿ç”¨åˆ‡ç‰‡å‰µå»ºå‰¯æœ¬
            try:
                client.send(data)
            except:
                self.clients.remove(client)
                client.close()

# ä½¿ç”¨ç¤ºä¾‹
def main():
    # å‰µå»ºæœå‹™å™¨
    server = SocketServer()
    
    try:
        # å•Ÿå‹•æœå‹™å™¨
        server.start()
        
        # ç­‰å¾…ä¸€æ®µæ™‚é–“
        time.sleep(5)
        
        # å»£æ’­æ¶ˆæ¯
        server.broadcast("Hello, clients!")
        
        # ç­‰å¾…ä¸€æ®µæ™‚é–“
        time.sleep(5)
    
    finally:
        # åœæ­¢æœå‹™å™¨
        server.stop()

if __name__ == '__main__':
    main()
```

### 2. Socketå®¢æˆ¶ç«¯

```python
import socket
import threading
import time
from typing import Optional
import sys
import os

class SocketClient:
    def __init__(self, host: str = 'localhost', port: int = 5000):
        """åˆå§‹åŒ–Socketå®¢æˆ¶ç«¯"""
        self.host = host
        self.port = port
        self.client_socket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        self.is_connected = False
        self.is_running = False
    
    def connect(self):
        """é€£æ¥åˆ°æœå‹™å™¨"""
        try:
            self.client_socket.connect((self.host, self.port))
            self.is_connected = True
            self.is_running = True
            print(f"Connected to {self.host}:{self.port}")
            
            # å•Ÿå‹•æ¥æ”¶æ¶ˆæ¯çš„ç·šç¨‹
            receive_thread = threading.Thread(target=self._receive_messages)
            receive_thread.daemon = True
            receive_thread.start()
            
        except Exception as e:
            print(f"Error connecting to server: {e}")
            self.disconnect()
    
    def disconnect(self):
        """æ–·é–‹é€£æ¥"""
        self.is_running = False
        try:
            self.client_socket.close()
        except:
            pass
        self.is_connected = False
    
    def send_message(self, message: str):
        """ç™¼é€æ¶ˆæ¯"""
        if not self.is_connected:
            print("Not connected to server")
            return
        
        try:
            # ç·¨ç¢¼æ¶ˆæ¯
            data = message.encode('utf-8')
            
            # ç™¼é€æ•¸æ“š
            self.client_socket.send(data)
            
        except Exception as e:
            print(f"Error sending message: {e}")
            self.disconnect()
    
    def _receive_messages(self):
        """æ¥æ”¶æ¶ˆæ¯"""
        while self.is_running:
            try:
                # æ¥æ”¶æ•¸æ“š
                data = self.client_socket.recv(1024)
                if not data:
                    break
                
                # è§£ç¢¼æ•¸æ“š
                message = data.decode('utf-8')
                print(f"Received: {message}")
            
            except Exception as e:
                print(f"Error receiving message: {e}")
                break
        
        self.disconnect()

# ä½¿ç”¨ç¤ºä¾‹
def main():
    # å‰µå»ºå®¢æˆ¶ç«¯
    client = SocketClient()
    
    try:
        # é€£æ¥åˆ°æœå‹™å™¨
        client.connect()
        
        # ç™¼é€æ¶ˆæ¯
        client.send_message("Hello, server!")
        
        # ç­‰å¾…ä¸€æ®µæ™‚é–“
        time.sleep(5)
        
        # ç™¼é€å¦ä¸€æ¢æ¶ˆæ¯
        client.send_message("Goodbye, server!")
        
        # ç­‰å¾…ä¸€æ®µæ™‚é–“
        time.sleep(5)
    
    finally:
        # æ–·é–‹é€£æ¥
        client.disconnect()

if __name__ == '__main__':
    main()
```

## ç·´ç¿’é¡Œ

1. **Socketæœå‹™å™¨**
   é–‹ç™¼ä¸€å€‹Socketæœå‹™å™¨ï¼š
   - æ”¯æŒå¤šå®¢æˆ¶ç«¯é€£æ¥
   - è™•ç†å®¢æˆ¶ç«¯æ¶ˆæ¯
   - å„ªåŒ–è³‡æºä½¿ç”¨
   - æä¾›éŒ¯èª¤è™•ç†

2. **Socketå®¢æˆ¶ç«¯**
   å‰µå»ºä¸€å€‹Socketå®¢æˆ¶ç«¯ï¼š
   - æ”¯æŒæœå‹™å™¨é€£æ¥
   - è™•ç†æœå‹™å™¨æ¶ˆæ¯
   - å„ªåŒ–é€šä¿¡æ•ˆç‡
   - æä¾›é‡é€£æ©Ÿåˆ¶

3. **ç¶²çµ¡æ¡†æ¶**
   å¯¦ç¾ä¸€å€‹ç¶²çµ¡æ¡†æ¶ï¼š
   - æ”¯æŒå¤šç¨®å”è­°
   - æä¾›é«˜ç´šAPI
   - å„ªåŒ–æ€§èƒ½
   - è™•ç†è¤‡é›œå ´æ™¯

## å°æé†’ ğŸ’¡

1. Socketç·¨ç¨‹
   - é¸æ“‡åˆé©å”è­°
   - è™•ç†é€£æ¥ç®¡ç†
   - å„ªåŒ–é€šä¿¡æ•ˆç‡
   - é¿å…é˜»å¡æ“ä½œ

2. ç¶²çµ¡é€šä¿¡
   - è¨­è¨ˆé€šä¿¡å”è­°
   - è™•ç†æ•¸æ“šå‚³è¼¸
   - å„ªåŒ–ç¶²çµ¡é–‹éŠ·
   - è™•ç†ç¶²çµ¡ç•°å¸¸

3. æ€§èƒ½å„ªåŒ–
   - æ¸›å°‘ç¶²çµ¡å»¶é²
   - å„ªåŒ–æ•¸æ“šå‚³è¼¸
   - å¹³è¡¡è² è¼‰
   - æé«˜ååé‡

4. èª¿è©¦æŠ€å·§
   - ä½¿ç”¨ç¶²çµ¡å·¥å…·
   - åˆ†æé€šä¿¡å•é¡Œ
   - å„ªåŒ–é—œéµè·¯å¾‘
   - ç›£æ§ç¶²çµ¡ç‹€æ…‹

[ä¸Šä¸€ç« ï¼šé€²ç¨‹ç·¨ç¨‹é€²éš](085_é€²ç¨‹ç·¨ç¨‹é€²éš.md) | [ä¸‹ä¸€ç« ï¼šç¶²çµ¡ç·¨ç¨‹é€²éš](087_ç¶²çµ¡ç·¨ç¨‹é€²éš.md) 
# Python IoTè¨­å‚™ç·¨ç¨‹ ğŸ”Œ

æœ¬ç« å°‡ä»‹ç´¹å¦‚ä½•ä½¿ç”¨ Python é€²è¡Œ IoT è¨­å‚™çš„é–‹ç™¼å’Œç·¨ç¨‹ï¼ŒåŒ…æ‹¬æ„Ÿæ¸¬å™¨æ•¸æ“šæ¡é›†ã€è¨­å‚™æ§åˆ¶å’Œé€šè¨Šå”è­°å¯¦ç¾ã€‚

## å­¸ç¿’ç›®æ¨™
- æŒæ¡ IoT è¨­å‚™ç·¨ç¨‹åŸºç¤
- å­¸ç¿’æ„Ÿæ¸¬å™¨æ•¸æ“šæ¡é›†æ–¹æ³•
- å¯¦ç¾è¨­å‚™é–“é€šè¨Šå”è­°
- é–‹ç™¼ IoT è¨­å‚™æ§åˆ¶ç³»çµ±

## æ„Ÿæ¸¬å™¨æ•¸æ“šæ¡é›†
```python
import time
import random
from abc import ABC, abstractmethod

class Sensor(ABC):
    def __init__(self, sensor_id, update_interval=1.0):
        self.sensor_id = sensor_id
        self.update_interval = update_interval
        self.last_reading = None
        self.last_update = 0
    
    @abstractmethod
    def read_data(self):
        """è®€å–æ„Ÿæ¸¬å™¨æ•¸æ“š"""
        pass
    
    def get_reading(self):
        """ç²å–æœ€æ–°è®€æ•¸"""
        current_time = time.time()
        if current_time - self.last_update >= self.update_interval:
            self.last_reading = self.read_data()
            self.last_update = current_time
        return self.last_reading

class TemperatureSensor(Sensor):
    def read_data(self):
        """æ¨¡æ“¬æº«åº¦æ„Ÿæ¸¬å™¨è®€æ•¸"""
        return {
            'temperature': 20 + random.uniform(-5, 5),
            'timestamp': time.time()
        }

class HumiditySensor(Sensor):
    def read_data(self):
        """æ¨¡æ“¬æ¿•åº¦æ„Ÿæ¸¬å™¨è®€æ•¸"""
        return {
            'humidity': 50 + random.uniform(-10, 10),
            'timestamp': time.time()
        }
```

## MQTT é€šè¨Š
```python
import paho.mqtt.client as mqtt
import json

class IoTDevice:
    def __init__(self, device_id, mqtt_broker, mqtt_port=1883):
        self.device_id = device_id
        self.client = mqtt.Client(device_id)
        self.client.on_connect = self._on_connect
        self.client.on_message = self._on_message
        
        self.client.connect(mqtt_broker, mqtt_port, 60)
        self.client.loop_start()
    
    def _on_connect(self, client, userdata, flags, rc):
        """é€£æ¥å›èª¿"""
        print(f"Connected with result code {rc}")
        self.client.subscribe(f"device/{self.device_id}/command")
    
    def _on_message(self, client, userdata, msg):
        """æ¶ˆæ¯å›èª¿"""
        try:
            payload = json.loads(msg.payload)
            self.handle_command(payload)
        except json.JSONDecodeError:
            print("Invalid message format")
    
    def publish_data(self, data):
        """ç™¼å¸ƒæ•¸æ“š"""
        self.client.publish(
            f"device/{self.device_id}/data",
            json.dumps(data)
        )
    
    def handle_command(self, command):
        """è™•ç†æ¥æ”¶åˆ°çš„å‘½ä»¤"""
        print(f"Received command: {command}")
```

## è¨­å‚™æ§åˆ¶
```python
class DeviceController:
    def __init__(self):
        self.devices = {}
        self.command_handlers = {}
    
    def register_device(self, device_id, device):
        """è¨»å†Šè¨­å‚™"""
        self.devices[device_id] = device
    
    def register_command_handler(self, command, handler):
        """è¨»å†Šå‘½ä»¤è™•ç†å™¨"""
        self.command_handlers[command] = handler
    
    def send_command(self, device_id, command, params=None):
        """ç™¼é€å‘½ä»¤åˆ°è¨­å‚™"""
        if device_id not in self.devices:
            raise ValueError(f"Device {device_id} not found")
        
        device = self.devices[device_id]
        command_data = {
            'command': command,
            'params': params or {}
        }
        device.publish_data(command_data)
```

## æ•¸æ“šå­˜å„²
```python
import sqlite3
from datetime import datetime

class IoTDataStore:
    def __init__(self, db_path):
        self.conn = sqlite3.connect(db_path)
        self.create_tables()
    
    def create_tables(self):
        """å‰µå»ºæ•¸æ“šè¡¨"""
        self.conn.execute('''
            CREATE TABLE IF NOT EXISTS sensor_data (
                id INTEGER PRIMARY KEY AUTOINCREMENT,
                device_id TEXT,
                sensor_type TEXT,
                value REAL,
                timestamp DATETIME
            )
        ''')
        self.conn.commit()
    
    def store_reading(self, device_id, sensor_type, value):
        """å­˜å„²æ„Ÿæ¸¬å™¨è®€æ•¸"""
        self.conn.execute('''
            INSERT INTO sensor_data 
            (device_id, sensor_type, value, timestamp)
            VALUES (?, ?, ?, ?)
        ''', (device_id, sensor_type, value, datetime.now()))
        self.conn.commit()
    
    def get_device_readings(self, device_id, limit=100):
        """ç²å–è¨­å‚™è®€æ•¸æ­·å²"""
        cursor = self.conn.execute('''
            SELECT * FROM sensor_data
            WHERE device_id = ?
            ORDER BY timestamp DESC
            LIMIT ?
        ''', (device_id, limit))
        return cursor.fetchall()
```

## å¯¦æˆ°ç·´ç¿’
1. å»ºç«‹å®Œæ•´çš„ IoT ç›£æ§ç³»çµ±
   - å¯¦ç¾å¤šç¨®æ„Ÿæ¸¬å™¨æ•¸æ“šæ¡é›†
   - å»ºç«‹å¯¦æ™‚æ•¸æ“šå‚³è¼¸
   - é–‹ç™¼æ•¸æ“šå¯è¦–åŒ–ç•Œé¢

2. é–‹ç™¼æ™ºèƒ½å®¶å±…æ§åˆ¶ç³»çµ±
   - å¯¦ç¾è¨­å‚™è‡ªå‹•åŒ–æ§åˆ¶
   - æ·»åŠ å®šæ™‚ä»»å‹™åŠŸèƒ½
   - å»ºç«‹å ´æ™¯è¯å‹•æ©Ÿåˆ¶

3. å¯¦ç¾ IoT ç¶²é—œ
   - æ”¯æŒå¤šç¨®é€šè¨Šå”è­°
   - å¯¦ç¾æ•¸æ“šè½‰ç™¼åŠŸèƒ½
   - æ·»åŠ å®‰å…¨èªè­‰æ©Ÿåˆ¶

## ç¸½çµ
- IoT è¨­å‚™ç·¨ç¨‹éœ€è¦è€ƒæ…®ç¡¬ä»¶é™åˆ¶
- é€šè¨Šå”è­°é¸æ“‡å°ç³»çµ±æ€§èƒ½å¾ˆé‡è¦
- æ•¸æ“šå®‰å…¨å’Œéš±ç§ä¿è­·ä¸å¯å¿½è¦–
- è¨­å‚™ç®¡ç†å’Œç›£æ§æ˜¯é—œéµåŠŸèƒ½

## å»¶ä¼¸é–±è®€
- IoT å”è­°æ¨™æº–
- æ„Ÿæ¸¬å™¨æŠ€è¡“ç™¼å±•
- åµŒå…¥å¼ç³»çµ±è¨­è¨ˆ
- IoT å®‰å…¨æœ€ä½³å¯¦è¸

---
ä¸‹ä¸€ç« ï¼š[é‚Šç·£AIæ‡‰ç”¨](./150_é‚Šç·£AIæ‡‰ç”¨.md) 
[ä¸Šä¸€ç« ï¼šå‡½å¼åŸºç¤](022_å‡½å¼åŸºç¤.md) | [ä¸‹ä¸€ç« ï¼šéè¿´å‡½å¼](024_éè¿´å‡½å¼.md)

# Python å‡½å¼é€²éšæ“ä½œ ğŸš€

## è£é£¾å™¨ï¼ˆDecoratorsï¼‰

è£é£¾å™¨æ˜¯ä¸€ç¨®å¯ä»¥ä¿®æ”¹å…¶ä»–å‡½å¼åŠŸèƒ½çš„å‡½å¼ï¼Œå¸¸ç”¨æ–¼æ·»åŠ é¡å¤–çš„è™•ç†é‚è¼¯ã€‚

### 1. åŸºæœ¬è£é£¾å™¨

```python
def timer(func):
    """è¨ˆç®—å‡½å¼åŸ·è¡Œæ™‚é–“çš„è£é£¾å™¨"""
    from time import time
    
    def wrapper(*args, **kwargs):
        start = time()
        result = func(*args, **kwargs)
        end = time()
        print(f"{func.__name__} åŸ·è¡Œæ™‚é–“ï¼š{end - start:.4f} ç§’")
        return result
    
    return wrapper

@timer
def slow_function():
    import time
    time.sleep(1)
    return "å®Œæˆ"

# ä½¿ç”¨è£é£¾å™¨
result = slow_function()  # æœƒå°å‡ºåŸ·è¡Œæ™‚é–“
```

### 2. å¸¶åƒæ•¸çš„è£é£¾å™¨

```python
def repeat(times):
    """é‡è¤‡åŸ·è¡ŒæŒ‡å®šæ¬¡æ•¸çš„è£é£¾å™¨"""
    def decorator(func):
        def wrapper(*args, **kwargs):
            for _ in range(times):
                result = func(*args, **kwargs)
            return result
        return wrapper
    return decorator

@repeat(times=3)
def greet(name):
    print(f"Hello, {name}!")

# æœƒå°å‡ºä¸‰æ¬¡å•å€™
greet("Alice")
```

## é–‰åŒ…ï¼ˆClosuresï¼‰

é–‰åŒ…æ˜¯ä¸€å€‹å‡½å¼ï¼Œå®ƒå¯ä»¥è¨˜ä½ä¸¦å­˜å–å…¶å¤–éƒ¨ä½œç”¨åŸŸçš„è®Šæ•¸ã€‚

```python
def counter(start=0):
    """å‰µå»ºä¸€å€‹è¨ˆæ•¸å™¨"""
    count = start
    
    def increment(step=1):
        nonlocal count
        count += step
        return count
    
    return increment

# ä½¿ç”¨é–‰åŒ…
counter1 = counter(10)
print(counter1())  # 11
print(counter1())  # 12

counter2 = counter(100)
print(counter2())  # 101
```

## Lambda å‡½å¼

Lambda æ˜¯ä¸€ç¨®ç°¡å–®çš„åŒ¿åå‡½å¼ï¼Œç”¨æ–¼å‰µå»ºä¸€æ¬¡æ€§çš„å°å‹å‡½å¼ã€‚

```python
# åŸºæœ¬ lambda å‡½å¼
square = lambda x: x**2
print(square(5))  # 25

# åœ¨æ’åºä¸­ä½¿ç”¨ lambda
students = [
    {'name': 'Alice', 'score': 85},
    {'name': 'Bob', 'score': 92},
    {'name': 'Charlie', 'score': 78}
]
sorted_students = sorted(students, key=lambda s: s['score'], reverse=True)

# åœ¨ map å’Œ filter ä¸­ä½¿ç”¨ lambda
numbers = [1, 2, 3, 4, 5]
squares = list(map(lambda x: x**2, numbers))
evens = list(filter(lambda x: x % 2 == 0, numbers))
```

## ç”Ÿæˆå™¨å‡½å¼ï¼ˆGenerator Functionsï¼‰

ç”Ÿæˆå™¨å‡½å¼ä½¿ç”¨ yield é—œéµå­—ï¼Œå¯ä»¥é€å€‹ç”¢ç”Ÿå€¼ï¼Œç¯€çœè¨˜æ†¶é«”ã€‚

```python
def fibonacci_generator(n):
    """ç”Ÿæˆæ–æ³¢é‚£å¥‘æ•¸åˆ—çš„ç”Ÿæˆå™¨"""
    a, b = 0, 1
    for _ in range(n):
        yield a
        a, b = b, a + b

# ä½¿ç”¨ç”Ÿæˆå™¨
for num in fibonacci_generator(10):
    print(num, end=' ')  # 0 1 1 2 3 5 8 13 21 34

# ç”Ÿæˆå™¨è¡¨é”å¼
squares = (x**2 for x in range(10))
```

## å‡½å¼è¨»è§£ï¼ˆFunction Annotationsï¼‰

å‡½å¼è¨»è§£ç”¨æ–¼æä¾›åƒæ•¸å’Œè¿”å›å€¼çš„é¡å‹æç¤ºã€‚

```python
def calculate_bmi(weight: float, height: float) -> float:
    """è¨ˆç®— BMI å€¼
    
    Args:
        weight: é«”é‡ï¼ˆå…¬æ–¤ï¼‰
        height: èº«é«˜ï¼ˆå…¬å°ºï¼‰
    
    Returns:
        float: BMI å€¼
    """
    return weight / (height ** 2)

# æŸ¥çœ‹å‡½å¼è¨»è§£
print(calculate_bmi.__annotations__)
```

## åå‡½å¼ï¼ˆPartial Functionsï¼‰

ä½¿ç”¨ functools.partial å‰µå»ºä¸€å€‹æ–°å‡½å¼ï¼Œå›ºå®šæŸäº›åƒæ•¸ã€‚

```python
from functools import partial

def power(base, exponent):
    return base ** exponent

# å‰µå»ºå¹³æ–¹å‡½å¼
square = partial(power, exponent=2)
print(square(5))  # 25

# å‰µå»ºç«‹æ–¹å‡½å¼
cube = partial(power, exponent=3)
print(cube(5))  # 125
```

## å¯¦ç”¨çš„å‡½å¼å·¥å…·

### 1. functools æ¨¡çµ„

```python
from functools import lru_cache, reduce

# ä½¿ç”¨å¿«å–è£é£¾å™¨
@lru_cache(maxsize=None)
def fibonacci(n):
    if n < 2:
        return n
    return fibonacci(n-1) + fibonacci(n-2)

# ä½¿ç”¨ reduce
numbers = [1, 2, 3, 4, 5]
product = reduce(lambda x, y: x * y, numbers)  # è¨ˆç®—ä¹˜ç©
```

### 2. operator æ¨¡çµ„

```python
from operator import itemgetter, attrgetter

# ä½¿ç”¨ itemgetter æ’åº
students = [('Alice', 85), ('Bob', 92), ('Charlie', 78)]
sorted_by_score = sorted(students, key=itemgetter(1))

# ä½¿ç”¨ attrgetter æ’åºç‰©ä»¶
class Student:
    def __init__(self, name, score):
        self.name = name
        self.score = score

students = [Student('Alice', 85), Student('Bob', 92)]
sorted_by_name = sorted(students, key=attrgetter('name'))
```

## ç·´ç¿’é¡Œ

1. **è£é£¾å™¨ç·´ç¿’**
   å¯¦ç¾ä»¥ä¸‹è£é£¾å™¨ï¼š
   - è¨˜éŒ„å‡½å¼å‘¼å«æ¬¡æ•¸
   - æª¢æŸ¥åƒæ•¸é¡å‹
   - å¿«å–å‡½å¼çµæœ
   - é™åˆ¶å‡½å¼åŸ·è¡Œæ™‚é–“

2. **ç”Ÿæˆå™¨ç·´ç¿’**
   å‰µå»ºä»¥ä¸‹ç”Ÿæˆå™¨ï¼š
   - ç”¢ç”Ÿè³ªæ•¸åºåˆ—
   - è®€å–å¤§æª”æ¡ˆçš„è¡Œ
   - ç”¢ç”Ÿæ—¥æœŸç¯„åœ
   - å¯¦ç¾è‡ªå®šç¾©è¿­ä»£å™¨

3. **å‡½å¼å·¥å…·æ‡‰ç”¨**
   é–‹ç™¼ä¸€å€‹æ•¸æ“šè™•ç†å·¥å…·ï¼š
   - ä½¿ç”¨è£é£¾å™¨é€²è¡Œæ•ˆèƒ½åˆ†æ
   - å¯¦ç¾æ•¸æ“šå¿«å–æ©Ÿåˆ¶
   - æ”¯æ´æ‰¹æ¬¡è™•ç†
   - æä¾›é€²åº¦å›å ±

## å°æé†’ ğŸ’¡

1. è£é£¾å™¨å¯ä»¥ç–ŠåŠ ä½¿ç”¨ï¼Œæ³¨æ„åŸ·è¡Œé †åº
2. é–‰åŒ…è¦æ³¨æ„è®Šæ•¸çš„ä½œç”¨åŸŸ
3. Lambda å‡½å¼æ‡‰è©²ä¿æŒç°¡å–®
4. ç”Ÿæˆå™¨é©åˆè™•ç†å¤§é‡æ•¸æ“š
5. å‡½å¼è¨»è§£æä¾›äº†æ›´å¥½çš„ç¨‹å¼ç¢¼å¯è®€æ€§
6. å–„ç”¨ functools å’Œ operator æ¨¡çµ„æä¾›çš„å·¥å…·

[ä¸Šä¸€ç« ï¼šå‡½å¼åŸºç¤](022_å‡½å¼åŸºç¤.md) | [ä¸‹ä¸€ç« ï¼šéè¿´å‡½å¼](024_éè¿´å‡½å¼.md) 
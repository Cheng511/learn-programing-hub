[ä¸Šä¸€ç« ï¼šè‡ªç„¶èªè¨€è™•ç†é€²éš](101_è‡ªç„¶èªè¨€è™•ç†é€²éš.md) | [ä¸‹ä¸€ç« ï¼šè¨ˆç®—æ©Ÿè¦–è¦ºé€²éš](103_è¨ˆç®—æ©Ÿè¦–è¦ºé€²éš.md)

# Python è¨ˆç®—æ©Ÿè¦–è¦ºåŸºç¤ ğŸ‘ï¸

## åœ–åƒè™•ç†åŸºç¤

### 1. åœ–åƒè®€å–å’Œè™•ç†

```python
import cv2
import numpy as np
from typing import Tuple, List, Optional
import time
import sys
import os

class ImageProcessor:
    def __init__(self):
        """åˆå§‹åŒ–åœ–åƒè™•ç†å™¨"""
        try:
            self.image = None
            self.height = 0
            self.width = 0
            self.channels = 0
            
            print("Image processor initialized")
            
        except Exception as e:
            print(f"Error initializing image processor: {e}")
    
    def read_image(self, image_path: str) -> bool:
        """è®€å–åœ–åƒ"""
        try:
            # è®€å–åœ–åƒ
            self.image = cv2.imread(image_path)
            
            if self.image is None:
                raise ValueError(f"Failed to read image: {image_path}")
            
            # ç²å–åœ–åƒä¿¡æ¯
            self.height, self.width = self.image.shape[:2]
            self.channels = self.image.shape[2] if len(self.image.shape) > 2 else 1
            
            print(f"Image loaded: {self.width}x{self.height} with {self.channels} channels")
            return True
            
        except Exception as e:
            print(f"Error reading image: {e}")
            return False
    
    def resize_image(self, width: int, height: int) -> np.ndarray:
        """èª¿æ•´åœ–åƒå¤§å°"""
        try:
            if self.image is None:
                raise ValueError("No image loaded")
            
            # èª¿æ•´åœ–åƒå¤§å°
            resized = cv2.resize(self.image, (width, height))
            return resized
            
        except Exception as e:
            print(f"Error resizing image: {e}")
            return np.array([])
    
    def convert_color_space(self, conversion_code: int) -> np.ndarray:
        """è½‰æ›é¡è‰²ç©ºé–“"""
        try:
            if self.image is None:
                raise ValueError("No image loaded")
            
            # è½‰æ›é¡è‰²ç©ºé–“
            converted = cv2.cvtColor(self.image, conversion_code)
            return converted
            
        except Exception as e:
            print(f"Error converting color space: {e}")
            return np.array([])
    
    def apply_filter(self, kernel: np.ndarray) -> np.ndarray:
        """æ‡‰ç”¨æ¿¾æ³¢å™¨"""
        try:
            if self.image is None:
                raise ValueError("No image loaded")
            
            # æ‡‰ç”¨æ¿¾æ³¢å™¨
            filtered = cv2.filter2D(self.image, -1, kernel)
            return filtered
            
        except Exception as e:
            print(f"Error applying filter: {e}")
            return np.array([])
    
    def adjust_brightness_contrast(self, alpha: float, beta: float) -> np.ndarray:
        """èª¿æ•´äº®åº¦å’Œå°æ¯”åº¦"""
        try:
            if self.image is None:
                raise ValueError("No image loaded")
            
            # èª¿æ•´äº®åº¦å’Œå°æ¯”åº¦
            adjusted = cv2.convertScaleAbs(self.image, alpha=alpha, beta=beta)
            return adjusted
            
        except Exception as e:
            print(f"Error adjusting brightness and contrast: {e}")
            return np.array([])
    
    def save_image(self, image: np.ndarray, output_path: str) -> bool:
        """ä¿å­˜åœ–åƒ"""
        try:
            if image.size == 0:
                raise ValueError("Empty image")
            
            # ä¿å­˜åœ–åƒ
            success = cv2.imwrite(output_path, image)
            
            if success:
                print(f"Image saved to: {output_path}")
            else:
                print(f"Failed to save image: {output_path}")
            
            return success
            
        except Exception as e:
            print(f"Error saving image: {e}")
            return False

# ä½¿ç”¨ç¤ºä¾‹
def main():
    # å‰µå»ºåœ–åƒè™•ç†å™¨
    processor = ImageProcessor()
    
    try:
        # è®€å–åœ–åƒ
        image_path = "example.jpg"
        if processor.read_image(image_path):
            # èª¿æ•´å¤§å°
            resized = processor.resize_image(800, 600)
            processor.save_image(resized, "resized.jpg")
            
            # è½‰æ›é¡è‰²ç©ºé–“
            gray = processor.convert_color_space(cv2.COLOR_BGR2GRAY)
            processor.save_image(gray, "gray.jpg")
            
            # æ‡‰ç”¨æ¿¾æ³¢å™¨
            kernel = np.ones((5, 5), np.float32) / 25
            filtered = processor.apply_filter(kernel)
            processor.save_image(filtered, "filtered.jpg")
            
            # èª¿æ•´äº®åº¦å’Œå°æ¯”åº¦
            adjusted = processor.adjust_brightness_contrast(1.2, 10)
            processor.save_image(adjusted, "adjusted.jpg")
    
    except Exception as e:
        print(f"Error in main: {e}")

if __name__ == '__main__':
    main()
```

### 2. åœ–åƒç‰¹å¾µæå–

```python
import cv2
import numpy as np
from typing import Tuple, List, Optional, Dict
import time
import sys
import os

class FeatureExtractor:
    def __init__(self):
        """åˆå§‹åŒ–ç‰¹å¾µæå–å™¨"""
        try:
            # åˆå§‹åŒ–SIFTæª¢æ¸¬å™¨
            self.sift = cv2.SIFT_create()
            
            # åˆå§‹åŒ–SURFæª¢æ¸¬å™¨
            self.surf = cv2.xfeatures2d.SURF_create()
            
            # åˆå§‹åŒ–ORBæª¢æ¸¬å™¨
            self.orb = cv2.ORB_create()
            
            print("Feature extractor initialized")
            
        except Exception as e:
            print(f"Error initializing feature extractor: {e}")
    
    def detect_sift_features(self, image: np.ndarray) -> Tuple[List[cv2.KeyPoint], np.ndarray]:
        """æª¢æ¸¬SIFTç‰¹å¾µ"""
        try:
            # è½‰æ›ç‚ºç°åº¦åœ–
            if len(image.shape) == 3:
                gray = cv2.cvtColor(image, cv2.COLOR_BGR2GRAY)
            else:
                gray = image
            
            # æª¢æ¸¬ç‰¹å¾µé»å’Œæè¿°ç¬¦
            keypoints, descriptors = self.sift.detectAndCompute(gray, None)
            
            return keypoints, descriptors
            
        except Exception as e:
            print(f"Error detecting SIFT features: {e}")
            return [], np.array([])
    
    def detect_surf_features(self, image: np.ndarray) -> Tuple[List[cv2.KeyPoint], np.ndarray]:
        """æª¢æ¸¬SURFç‰¹å¾µ"""
        try:
            # è½‰æ›ç‚ºç°åº¦åœ–
            if len(image.shape) == 3:
                gray = cv2.cvtColor(image, cv2.COLOR_BGR2GRAY)
            else:
                gray = image
            
            # æª¢æ¸¬ç‰¹å¾µé»å’Œæè¿°ç¬¦
            keypoints, descriptors = self.surf.detectAndCompute(gray, None)
            
            return keypoints, descriptors
            
        except Exception as e:
            print(f"Error detecting SURF features: {e}")
            return [], np.array([])
    
    def detect_orb_features(self, image: np.ndarray) -> Tuple[List[cv2.KeyPoint], np.ndarray]:
        """æª¢æ¸¬ORBç‰¹å¾µ"""
        try:
            # è½‰æ›ç‚ºç°åº¦åœ–
            if len(image.shape) == 3:
                gray = cv2.cvtColor(image, cv2.COLOR_BGR2GRAY)
            else:
                gray = image
            
            # æª¢æ¸¬ç‰¹å¾µé»å’Œæè¿°ç¬¦
            keypoints, descriptors = self.orb.detectAndCompute(gray, None)
            
            return keypoints, descriptors
            
        except Exception as e:
            print(f"Error detecting ORB features: {e}")
            return [], np.array([])
    
    def match_features(self, descriptors1: np.ndarray, descriptors2: np.ndarray, method: str = 'FLANN') -> List[cv2.DMatch]:
        """åŒ¹é…ç‰¹å¾µ"""
        try:
            if method == 'FLANN':
                # FLANNåŒ¹é…å™¨åƒæ•¸
                FLANN_INDEX_KDTREE = 1
                index_params = dict(algorithm=FLANN_INDEX_KDTREE, trees=5)
                search_params = dict(checks=50)
                matcher = cv2.FlannBasedMatcher(index_params, search_params)
            else:
                # æš´åŠ›åŒ¹é…å™¨
                matcher = cv2.BFMatcher()
            
            # åŒ¹é…ç‰¹å¾µ
            matches = matcher.knnMatch(descriptors1, descriptors2, k=2)
            
            # æ‡‰ç”¨Lowe's ratioæ¸¬è©¦
            good_matches = []
            for m, n in matches:
                if m.distance < 0.7 * n.distance:
                    good_matches.append(m)
            
            return good_matches
            
        except Exception as e:
            print(f"Error matching features: {e}")
            return []
    
    def draw_matches(self, image1: np.ndarray, image2: np.ndarray, keypoints1: List[cv2.KeyPoint], keypoints2: List[cv2.KeyPoint], matches: List[cv2.DMatch]) -> np.ndarray:
        """ç¹ªè£½åŒ¹é…çµæœ"""
        try:
            # ç¹ªè£½åŒ¹é…çµæœ
            result = cv2.drawMatches(image1, keypoints1, image2, keypoints2, matches, None,
                                   flags=cv2.DrawMatchesFlags_NOT_DRAW_SINGLE_POINTS)
            
            return result
            
        except Exception as e:
            print(f"Error drawing matches: {e}")
            return np.array([])

# ä½¿ç”¨ç¤ºä¾‹
def main():
    # å‰µå»ºç‰¹å¾µæå–å™¨
    extractor = FeatureExtractor()
    
    try:
        # è®€å–åœ–åƒ
        image1 = cv2.imread("image1.jpg")
        image2 = cv2.imread("image2.jpg")
        
        if image1 is not None and image2 is not None:
            # æª¢æ¸¬SIFTç‰¹å¾µ
            kp1, des1 = extractor.detect_sift_features(image1)
            kp2, des2 = extractor.detect_sift_features(image2)
            
            # åŒ¹é…ç‰¹å¾µ
            matches = extractor.match_features(des1, des2)
            
            # ç¹ªè£½åŒ¹é…çµæœ
            result = extractor.draw_matches(image1, image2, kp1, kp2, matches)
            
            # ä¿å­˜çµæœ
            cv2.imwrite("matches.jpg", result)
    
    except Exception as e:
        print(f"Error in main: {e}")

if __name__ == '__main__':
    main()
```

## ç·´ç¿’é¡Œ

1. **åœ–åƒè™•ç†**
   é–‹ç™¼åœ–åƒè™•ç†ï¼š
   - è®€å–åœ–åƒ
   - èª¿æ•´å¤§å°
   - é¡è‰²è½‰æ›
   - å„ªåŒ–æ€§èƒ½

2. **ç‰¹å¾µæå–**
   å‰µå»ºç‰¹å¾µæå–ï¼š
   - SIFTç‰¹å¾µ
   - SURFç‰¹å¾µ
   - ORBç‰¹å¾µ
   - å„ªåŒ–æ€§èƒ½

3. **è¨ˆç®—æ©Ÿè¦–è¦º**
   å¯¦ç¾è¨ˆç®—æ©Ÿè¦–è¦ºï¼š
   - è™•ç†åœ–åƒ
   - æå–ç‰¹å¾µ
   - å„ªåŒ–æ€§èƒ½
   - è™•ç†ç•°å¸¸

## å°æé†’ ğŸ’¡

1. åœ–åƒè™•ç†
   - é¸æ“‡åˆé©æ–¹æ³•
   - å„ªåŒ–åƒæ•¸
   - è™•ç†ç•°å¸¸
   - æä¾›ç›£æ§

2. ç‰¹å¾µæå–
   - é¸æ“‡åˆé©æ–¹æ³•
   - å„ªåŒ–æ€§èƒ½
   - è™•ç†ç•°å¸¸
   - æä¾›çµæœ

3. è¨ˆç®—æ©Ÿè¦–è¦º
   - é¸æ“‡åˆé©ç®—æ³•
   - å„ªåŒ–æ€§èƒ½
   - è™•ç†ç•°å¸¸
   - æä¾›ç›£æ§

4. èª¿è©¦æŠ€å·§
   - ä½¿ç”¨é–‹ç™¼å·¥å…·
   - åˆ†ææ€§èƒ½
   - å„ªåŒ–é—œéµè·¯å¾‘
   - ç›£æ§è™•ç†ç‹€æ…‹

[ä¸Šä¸€ç« ï¼šè‡ªç„¶èªè¨€è™•ç†é€²éš](101_è‡ªç„¶èªè¨€è™•ç†é€²éš.md) | [ä¸‹ä¸€ç« ï¼šè¨ˆç®—æ©Ÿè¦–è¦ºé€²éš](103_è¨ˆç®—æ©Ÿè¦–è¦ºé€²éš.md) 
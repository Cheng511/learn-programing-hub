[ä¸Šä¸€ç« ï¼šéŠæˆ²é–‹ç™¼é€²éš](107_éŠæˆ²é–‹ç™¼é€²éš.md) | [ä¸‹ä¸€ç« ï¼šç¶²çµ¡ç·¨ç¨‹é€²éš](109_ç¶²çµ¡ç·¨ç¨‹é€²éš.md)

# Python ç¶²çµ¡ç·¨ç¨‹åŸºç¤ ğŸŒ

## ç¶²çµ¡ç·¨ç¨‹åŸºç¤

### 1. ç¶²çµ¡é€šä¿¡

```python
import socket
import sys
import os
from typing import Tuple, List, Optional, Dict
import time
import json

class NetworkClient:
    def __init__(self, host: str = 'localhost', port: int = 5000):
        """åˆå§‹åŒ–ç¶²çµ¡å®¢æˆ¶ç«¯"""
        try:
            # å‰µå»ºå¥—æ¥å­—
            self.socket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
            
            # è¨­ç½®åœ°å€
            self.host = host
            self.port = port
            
            print(f"Network client initialized: {host}:{port}")
            
        except Exception as e:
            print(f"Error initializing network client: {e}")
    
    def connect(self) -> bool:
        """é€£æ¥åˆ°æœå‹™å™¨"""
        try:
            self.socket.connect((self.host, self.port))
            print(f"Connected to {self.host}:{self.port}")
            return True
            
        except Exception as e:
            print(f"Error connecting to server: {e}")
            return False
    
    def send_data(self, data: Dict) -> bool:
        """ç™¼é€æ•¸æ“š"""
        try:
            # å°‡æ•¸æ“šè½‰æ›ç‚ºJSONå­—ç¬¦ä¸²
            message = json.dumps(data)
            
            # ç™¼é€æ•¸æ“š
            self.socket.send(message.encode())
            print(f"Data sent: {data}")
            return True
            
        except Exception as e:
            print(f"Error sending data: {e}")
            return False
    
    def receive_data(self) -> Optional[Dict]:
        """æ¥æ”¶æ•¸æ“š"""
        try:
            # æ¥æ”¶æ•¸æ“š
            data = self.socket.recv(1024).decode()
            
            # è§£æJSONæ•¸æ“š
            if data:
                return json.loads(data)
            return None
            
        except Exception as e:
            print(f"Error receiving data: {e}")
            return None
    
    def close(self):
        """é—œé–‰é€£æ¥"""
        try:
            self.socket.close()
            print("Connection closed")
            
        except Exception as e:
            print(f"Error closing connection: {e}")

class NetworkServer:
    def __init__(self, host: str = 'localhost', port: int = 5000):
        """åˆå§‹åŒ–ç¶²çµ¡æœå‹™å™¨"""
        try:
            # å‰µå»ºå¥—æ¥å­—
            self.socket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
            
            # è¨­ç½®åœ°å€
            self.host = host
            self.port = port
            
            # ç¶å®šåœ°å€
            self.socket.bind((host, port))
            
            # é–‹å§‹ç›£è½
            self.socket.listen(5)
            
            print(f"Network server initialized: {host}:{port}")
            
        except Exception as e:
            print(f"Error initializing network server: {e}")
    
    def accept_connection(self) -> Optional[socket.socket]:
        """æ¥å—é€£æ¥"""
        try:
            client_socket, address = self.socket.accept()
            print(f"Connection accepted from {address}")
            return client_socket
            
        except Exception as e:
            print(f"Error accepting connection: {e}")
            return None
    
    def send_data(self, client_socket: socket.socket, data: Dict) -> bool:
        """ç™¼é€æ•¸æ“š"""
        try:
            # å°‡æ•¸æ“šè½‰æ›ç‚ºJSONå­—ç¬¦ä¸²
            message = json.dumps(data)
            
            # ç™¼é€æ•¸æ“š
            client_socket.send(message.encode())
            print(f"Data sent: {data}")
            return True
            
        except Exception as e:
            print(f"Error sending data: {e}")
            return False
    
    def receive_data(self, client_socket: socket.socket) -> Optional[Dict]:
        """æ¥æ”¶æ•¸æ“š"""
        try:
            # æ¥æ”¶æ•¸æ“š
            data = client_socket.recv(1024).decode()
            
            # è§£æJSONæ•¸æ“š
            if data:
                return json.loads(data)
            return None
            
        except Exception as e:
            print(f"Error receiving data: {e}")
            return None
    
    def close(self):
        """é—œé–‰æœå‹™å™¨"""
        try:
            self.socket.close()
            print("Server closed")
            
        except Exception as e:
            print(f"Error closing server: {e}")

# ä½¿ç”¨ç¤ºä¾‹
def main():
    # å‰µå»ºæœå‹™å™¨
    server = NetworkServer()
    
    try:
        # æ¥å—é€£æ¥
        client_socket = server.accept_connection()
        if client_socket:
            # æ¥æ”¶æ•¸æ“š
            data = server.receive_data(client_socket)
            if data:
                print(f"Received data: {data}")
                
                # ç™¼é€éŸ¿æ‡‰
                response = {"status": "success", "message": "Data received"}
                server.send_data(client_socket, response)
            
            # é—œé–‰å®¢æˆ¶ç«¯é€£æ¥
            client_socket.close()
        
        # é—œé–‰æœå‹™å™¨
        server.close()
    
    except Exception as e:
        print(f"Error in main: {e}")

if __name__ == '__main__':
    main()
```

### 2. ç¶²çµ¡å”è­°

```python
import socket
import sys
import os
from typing import Tuple, List, Optional, Dict
import time
import json

class ProtocolClient:
    def __init__(self, host: str = 'localhost', port: int = 5000):
        """åˆå§‹åŒ–å”è­°å®¢æˆ¶ç«¯"""
        try:
            # å‰µå»ºå¥—æ¥å­—
            self.socket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
            
            # è¨­ç½®åœ°å€
            self.host = host
            self.port = port
            
            print(f"Protocol client initialized: {host}:{port}")
            
        except Exception as e:
            print(f"Error initializing protocol client: {e}")
    
    def connect(self) -> bool:
        """é€£æ¥åˆ°æœå‹™å™¨"""
        try:
            self.socket.connect((self.host, self.port))
            print(f"Connected to {self.host}:{self.port}")
            return True
            
        except Exception as e:
            print(f"Error connecting to server: {e}")
            return False
    
    def send_message(self, message_type: str, data: Dict) -> bool:
        """ç™¼é€æ¶ˆæ¯"""
        try:
            # æ§‹å»ºæ¶ˆæ¯
            message = {
                "type": message_type,
                "data": data
            }
            
            # å°‡æ¶ˆæ¯è½‰æ›ç‚ºJSONå­—ç¬¦ä¸²
            message_str = json.dumps(message)
            
            # ç™¼é€æ¶ˆæ¯
            self.socket.send(message_str.encode())
            print(f"Message sent: {message}")
            return True
            
        except Exception as e:
            print(f"Error sending message: {e}")
            return False
    
    def receive_message(self) -> Optional[Dict]:
        """æ¥æ”¶æ¶ˆæ¯"""
        try:
            # æ¥æ”¶æ•¸æ“š
            data = self.socket.recv(1024).decode()
            
            # è§£æJSONæ•¸æ“š
            if data:
                return json.loads(data)
            return None
            
        except Exception as e:
            print(f"Error receiving message: {e}")
            return None
    
    def close(self):
        """é—œé–‰é€£æ¥"""
        try:
            self.socket.close()
            print("Connection closed")
            
        except Exception as e:
            print(f"Error closing connection: {e}")

class ProtocolServer:
    def __init__(self, host: str = 'localhost', port: int = 5000):
        """åˆå§‹åŒ–å”è­°æœå‹™å™¨"""
        try:
            # å‰µå»ºå¥—æ¥å­—
            self.socket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
            
            # è¨­ç½®åœ°å€
            self.host = host
            self.port = port
            
            # ç¶å®šåœ°å€
            self.socket.bind((host, port))
            
            # é–‹å§‹ç›£è½
            self.socket.listen(5)
            
            print(f"Protocol server initialized: {host}:{port}")
            
        except Exception as e:
            print(f"Error initializing protocol server: {e}")
    
    def accept_connection(self) -> Optional[socket.socket]:
        """æ¥å—é€£æ¥"""
        try:
            client_socket, address = self.socket.accept()
            print(f"Connection accepted from {address}")
            return client_socket
            
        except Exception as e:
            print(f"Error accepting connection: {e}")
            return None
    
    def send_message(self, client_socket: socket.socket, message_type: str, data: Dict) -> bool:
        """ç™¼é€æ¶ˆæ¯"""
        try:
            # æ§‹å»ºæ¶ˆæ¯
            message = {
                "type": message_type,
                "data": data
            }
            
            # å°‡æ¶ˆæ¯è½‰æ›ç‚ºJSONå­—ç¬¦ä¸²
            message_str = json.dumps(message)
            
            # ç™¼é€æ¶ˆæ¯
            client_socket.send(message_str.encode())
            print(f"Message sent: {message}")
            return True
            
        except Exception as e:
            print(f"Error sending message: {e}")
            return False
    
    def receive_message(self, client_socket: socket.socket) -> Optional[Dict]:
        """æ¥æ”¶æ¶ˆæ¯"""
        try:
            # æ¥æ”¶æ•¸æ“š
            data = client_socket.recv(1024).decode()
            
            # è§£æJSONæ•¸æ“š
            if data:
                return json.loads(data)
            return None
            
        except Exception as e:
            print(f"Error receiving message: {e}")
            return None
    
    def handle_message(self, message: Dict) -> Dict:
        """è™•ç†æ¶ˆæ¯"""
        try:
            message_type = message.get("type")
            data = message.get("data", {})
            
            # æ ¹æ“šæ¶ˆæ¯é¡å‹è™•ç†
            if message_type == "echo":
                return {"type": "response", "data": data}
            elif message_type == "ping":
                return {"type": "pong", "data": {"time": time.time()}}
            else:
                return {"type": "error", "data": {"message": "Unknown message type"}}
            
        except Exception as e:
            print(f"Error handling message: {e}")
            return {"type": "error", "data": {"message": str(e)}"}
    
    def close(self):
        """é—œé–‰æœå‹™å™¨"""
        try:
            self.socket.close()
            print("Server closed")
            
        except Exception as e:
            print(f"Error closing server: {e}")

# ä½¿ç”¨ç¤ºä¾‹
def main():
    # å‰µå»ºæœå‹™å™¨
    server = ProtocolServer()
    
    try:
        # æ¥å—é€£æ¥
        client_socket = server.accept_connection()
        if client_socket:
            # æ¥æ”¶æ¶ˆæ¯
            message = server.receive_message(client_socket)
            if message:
                print(f"Received message: {message}")
                
                # è™•ç†æ¶ˆæ¯
                response = server.handle_message(message)
                
                # ç™¼é€éŸ¿æ‡‰
                server.send_message(client_socket, response["type"], response["data"])
            
            # é—œé–‰å®¢æˆ¶ç«¯é€£æ¥
            client_socket.close()
        
        # é—œé–‰æœå‹™å™¨
        server.close()
    
    except Exception as e:
        print(f"Error in main: {e}")

if __name__ == '__main__':
    main()
```

## ç·´ç¿’é¡Œ

1. **ç¶²çµ¡é€šä¿¡**
   é–‹ç™¼ç¶²çµ¡é€šä¿¡ï¼š
   - å®¢æˆ¶ç«¯
   - æœå‹™å™¨
   - æ•¸æ“šå‚³è¼¸
   - å„ªåŒ–æ€§èƒ½

2. **ç¶²çµ¡å”è­°**
   å‰µå»ºç¶²çµ¡å”è­°ï¼š
   - æ¶ˆæ¯æ ¼å¼
   - å”è­°è™•ç†
   - éŒ¯èª¤è™•ç†
   - å„ªåŒ–æ€§èƒ½

3. **ç¶²çµ¡ç·¨ç¨‹**
   å¯¦ç¾ç¶²çµ¡ç·¨ç¨‹ï¼š
   - é€šä¿¡ç³»çµ±
   - å”è­°ç³»çµ±
   - å„ªåŒ–æ€§èƒ½
   - è™•ç†ç•°å¸¸

## å°æé†’ ğŸ’¡

1. ç¶²çµ¡é€šä¿¡
   - é¸æ“‡åˆé©æ–¹æ³•
   - å„ªåŒ–åƒæ•¸
   - è™•ç†ç•°å¸¸
   - æä¾›ç›£æ§

2. ç¶²çµ¡å”è­°
   - é¸æ“‡åˆé©æ–¹æ³•
   - å„ªåŒ–æ€§èƒ½
   - è™•ç†ç•°å¸¸
   - æä¾›çµæœ

3. ç¶²çµ¡ç·¨ç¨‹
   - é¸æ“‡åˆé©ç®—æ³•
   - å„ªåŒ–æ€§èƒ½
   - è™•ç†ç•°å¸¸
   - æä¾›ç›£æ§

4. èª¿è©¦æŠ€å·§
   - ä½¿ç”¨é–‹ç™¼å·¥å…·
   - åˆ†ææ€§èƒ½
   - å„ªåŒ–é—œéµè·¯å¾‘
   - ç›£æ§è™•ç†ç‹€æ…‹

[ä¸Šä¸€ç« ï¼šéŠæˆ²é–‹ç™¼é€²éš](107_éŠæˆ²é–‹ç™¼é€²éš.md) | [ä¸‹ä¸€ç« ï¼šç¶²çµ¡ç·¨ç¨‹é€²éš](109_ç¶²çµ¡ç·¨ç¨‹é€²éš.md) 
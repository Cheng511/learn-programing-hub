[ä¸Šä¸€ç« ï¼šç•°å¸¸è™•ç†åŸºç¤](031_ç•°å¸¸è™•ç†åŸºç¤.md) | [ä¸‹ä¸€ç« ï¼šæª”æ¡ˆè™•ç†åŸºç¤](033_æª”æ¡ˆè™•ç†åŸºç¤.md)

# Python ç•°å¸¸è™•ç†é€²éš ğŸ¯

## ç•°å¸¸è™•ç†çš„é€²éšæŠ€å·§

### 1. ç•°å¸¸éˆ

```python
def process_data():
    try:
        # å˜—è©¦è™•ç†æ•¸æ“š
        raise ValueError("ç„¡æ•ˆçš„æ•¸æ“šæ ¼å¼")
    except ValueError as e:
        # ä¿ç•™åŸå§‹ç•°å¸¸è³‡è¨Š
        raise RuntimeError("æ•¸æ“šè™•ç†å¤±æ•—") from e

# ä½¿ç”¨ç•°å¸¸éˆ
try:
    process_data()
except RuntimeError as e:
    print(f"éŒ¯èª¤ï¼š{e}")
    print(f"åŸå› ï¼š{e.__cause__}")
```

### 2. ä¸Šä¸‹æ–‡ç®¡ç†å™¨

```python
class DatabaseConnection:
    def __init__(self, connection_string):
        self.connection_string = connection_string
    
    def __enter__(self):
        print("é€£æ¥æ•¸æ“šåº«")
        return self
    
    def __exit__(self, exc_type, exc_val, exc_tb):
        print("é—œé–‰æ•¸æ“šåº«é€£æ¥")
        if exc_type:
            print(f"è™•ç†ç•°å¸¸ï¼š{exc_type.__name__}")
        return False  # ä¸æŠ‘åˆ¶ç•°å¸¸

# ä½¿ç”¨ä¸Šä¸‹æ–‡ç®¡ç†å™¨
with DatabaseConnection("mysql://localhost") as db:
    # åœ¨é€™è£¡é€²è¡Œæ•¸æ“šåº«æ“ä½œ
    print("åŸ·è¡Œæ•¸æ“šåº«æ“ä½œ")
```

## è‡ªå®šç¾©ç•°å¸¸å±¤æ¬¡çµæ§‹

### 1. å‰µå»ºç•°å¸¸å±¤æ¬¡

```python
class ApplicationError(Exception):
    """æ‡‰ç”¨ç¨‹åºåŸºç¤ç•°å¸¸"""
    pass

class ValidationError(ApplicationError):
    """é©—è­‰éŒ¯èª¤"""
    pass

class DatabaseError(ApplicationError):
    """æ•¸æ“šåº«éŒ¯èª¤"""
    pass

class NetworkError(ApplicationError):
    """ç¶²çµ¡éŒ¯èª¤"""
    pass

# ä½¿ç”¨ç•°å¸¸å±¤æ¬¡
def validate_user(user_data):
    if not user_data:
        raise ValidationError("ç”¨æˆ¶æ•¸æ“šä¸èƒ½ç‚ºç©º")
    if "username" not in user_data:
        raise ValidationError("ç¼ºå°‘ç”¨æˆ¶å")
    if "email" not in user_data:
        raise ValidationError("ç¼ºå°‘é›»å­éƒµä»¶")
```

### 2. ç•°å¸¸è™•ç†ç­–ç•¥

```python
def process_user_registration(user_data):
    try:
        validate_user(user_data)
        save_to_database(user_data)
        send_confirmation_email(user_data)
    except ValidationError as e:
        log_error("é©—è­‰éŒ¯èª¤", e)
        raise
    except DatabaseError as e:
        log_error("æ•¸æ“šåº«éŒ¯èª¤", e)
        # é‡è©¦æˆ–å›æ»¾æ“ä½œ
        rollback_transaction()
        raise
    except NetworkError as e:
        log_error("ç¶²çµ¡éŒ¯èª¤", e)
        # é‡è©¦ç™¼é€éƒµä»¶
        retry_send_email(user_data)
```

## ç•°å¸¸è™•ç†çš„è¨­è¨ˆæ¨¡å¼

### 1. é‡è©¦æ¨¡å¼

```python
import time
from functools import wraps

def retry(max_attempts=3, delay=1):
    def decorator(func):
        @wraps(func)
        def wrapper(*args, **kwargs):
            attempts = 0
            while attempts < max_attempts:
                try:
                    return func(*args, **kwargs)
                except Exception as e:
                    attempts += 1
                    if attempts == max_attempts:
                        raise
                    time.sleep(delay)
            return None
        return wrapper
    return decorator

# ä½¿ç”¨é‡è©¦è£é£¾å™¨
@retry(max_attempts=3, delay=2)
def unstable_network_call():
    # æ¨¡æ“¬ä¸ç©©å®šçš„ç¶²çµ¡èª¿ç”¨
    import random
    if random.random() < 0.7:
        raise ConnectionError("ç¶²çµ¡é€£æ¥å¤±æ•—")
    return "æˆåŠŸ"
```

### 2. å›é€€æ¨¡å¼

```python
class ServiceUnavailable(Exception):
    pass

def fallback_mechanism(func):
    @wraps(func)
    def wrapper(*args, **kwargs):
        try:
            return func(*args, **kwargs)
        except ServiceUnavailable:
            return get_cached_data()  # å›é€€åˆ°ç·©å­˜æ•¸æ“š
        except Exception:
            return get_default_response()  # å›é€€åˆ°é»˜èªéŸ¿æ‡‰
    return wrapper

@fallback_mechanism
def get_user_data(user_id):
    # å˜—è©¦å¾æœå‹™ç²å–æ•¸æ“š
    if not is_service_available():
        raise ServiceUnavailable()
    return fetch_user_data(user_id)
```

## ç•°å¸¸è™•ç†çš„æœ€ä½³å¯¦è¸

### 1. ç•°å¸¸è™•ç†å±¤æ¬¡

```python
class DataProcessor:
    def __init__(self):
        self.errors = []
    
    def process_item(self, item):
        try:
            self.validate_item(item)
            self.transform_item(item)
            self.save_item(item)
        except ValidationError as e:
            self.errors.append({"item": item, "error": str(e)})
            return False
        except Exception as e:
            # è¨˜éŒ„æœªé æœŸçš„éŒ¯èª¤
            log_unexpected_error(e)
            raise
        return True
    
    def process_batch(self, items):
        results = []
        for item in items:
            success = self.process_item(item)
            results.append(success)
        return results
```

### 2. æ—¥èªŒå’Œç›£æ§

```python
import logging
import traceback

class ErrorLogger:
    def __init__(self):
        self.logger = logging.getLogger(__name__)
    
    def log_error(self, error, context=None):
        """è¨˜éŒ„éŒ¯èª¤ä¿¡æ¯"""
        error_info = {
            "type": type(error).__name__,
            "message": str(error),
            "traceback": traceback.format_exc(),
            "context": context
        }
        self.logger.error(f"Error occurred: {error_info}")
        
    def monitor_errors(self, func):
        """ç›£æ§å‡½å¼åŸ·è¡Œä¸­çš„éŒ¯èª¤"""
        @wraps(func)
        def wrapper(*args, **kwargs):
            try:
                return func(*args, **kwargs)
            except Exception as e:
                self.log_error(e, {
                    "function": func.__name__,
                    "args": args,
                    "kwargs": kwargs
                })
                raise
        return wrapper
```

## é€²éšç•°å¸¸è™•ç†ç¯„ä¾‹

### 1. äº‹å‹™ç®¡ç†

```python
class Transaction:
    def __init__(self):
        self.operations = []
        self.compensations = []
    
    def add_operation(self, operation, compensation):
        self.operations.append(operation)
        self.compensations.append(compensation)
    
    def execute(self):
        executed = []
        try:
            for operation in self.operations:
                operation()
                executed.append(operation)
        except Exception:
            # å›æ»¾å·²åŸ·è¡Œçš„æ“ä½œ
            for compensation in reversed(self.compensations[:len(executed)]):
                try:
                    compensation()
                except Exception as e:
                    log_error("å›æ»¾å¤±æ•—", e)
            raise
```

### 2. è³‡æºæ± ç®¡ç†

```python
class ResourcePool:
    def __init__(self, size):
        self.resources = []
        self.size = size
        self.available = []
    
    def initialize(self):
        try:
            for _ in range(self.size):
                resource = self.create_resource()
                self.resources.append(resource)
                self.available.append(resource)
        except Exception as e:
            self.cleanup()
            raise ResourceInitError("è³‡æºæ± åˆå§‹åŒ–å¤±æ•—") from e
    
    def get_resource(self):
        if not self.available:
            raise ResourceExhaustedError("ç„¡å¯ç”¨è³‡æº")
        return self.available.pop()
    
    def return_resource(self, resource):
        if resource in self.resources and resource not in self.available:
            self.available.append(resource)
```

## ç·´ç¿’é¡Œ

1. **ç•°å¸¸è™•ç†æ¡†æ¶**
   å¯¦ç¾ä¸€å€‹ç•°å¸¸è™•ç†æ¡†æ¶ï¼š
   - å®šç¾©ç•°å¸¸å±¤æ¬¡çµæ§‹
   - å¯¦ç¾é‡è©¦æ©Ÿåˆ¶
   - æ·»åŠ æ—¥èªŒè¨˜éŒ„
   - æ”¯æ´å›é€€ç­–ç•¥

2. **è³‡æºç®¡ç†ç³»çµ±**
   å‰µå»ºä¸€å€‹è³‡æºç®¡ç†ç³»çµ±ï¼š
   - å¯¦ç¾è³‡æºæ± 
   - è™•ç†è³‡æºè€—ç›¡
   - å¯¦ç¾è‡ªå‹•æ¸…ç†
   - æ”¯æ´äº‹å‹™æ“ä½œ

3. **éŒ¯èª¤å ±å‘Šç³»çµ±**
   é–‹ç™¼ä¸€å€‹éŒ¯èª¤å ±å‘Šç³»çµ±ï¼š
   - æ”¶é›†éŒ¯èª¤ä¿¡æ¯
   - åˆ†é¡å’Œéæ¿¾éŒ¯èª¤
   - ç”ŸæˆéŒ¯èª¤å ±å‘Š
   - å¯¦ç¾éŒ¯èª¤é€šçŸ¥

## å°æé†’ ğŸ’¡

1. è¨­è¨ˆåˆé©çš„ç•°å¸¸å±¤æ¬¡çµæ§‹
2. å¯¦ç¾å®Œå–„çš„éŒ¯èª¤è™•ç†ç­–ç•¥
3. é©ç•¶ä½¿ç”¨ç•°å¸¸éˆ
4. ç¢ºä¿è³‡æºæ­£ç¢ºé‡‹æ”¾
5. è¨˜éŒ„è©³ç´°çš„éŒ¯èª¤ä¿¡æ¯
6. è€ƒæ…®ä½¿ç”¨é‡è©¦æ©Ÿåˆ¶

[ä¸Šä¸€ç« ï¼šç•°å¸¸è™•ç†åŸºç¤](031_ç•°å¸¸è™•ç†åŸºç¤.md) | [ä¸‹ä¸€ç« ï¼šæª”æ¡ˆè™•ç†åŸºç¤](033_æª”æ¡ˆè™•ç†åŸºç¤.md) 
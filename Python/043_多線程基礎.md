[ä¸Šä¸€ç« ï¼šè³‡æ–™åº«æœ€ä½³å¯¦è¸](042_è³‡æ–™åº«æœ€ä½³å¯¦è¸.md) | [ä¸‹ä¸€ç« ï¼šå¤šç·šç¨‹é€²éš](044_å¤šç·šç¨‹é€²éš.md)

# Python å¤šç·šç¨‹åŸºç¤ ğŸ§µ

## ç·šç¨‹åŸºæœ¬æ¦‚å¿µ

### 1. å‰µå»ºç·šç¨‹

```python
import threading
import time

def worker():
    """ç·šç¨‹å·¥ä½œå‡½æ•¸"""
    print(f"ç·šç¨‹ {threading.current_thread().name} é–‹å§‹å·¥ä½œ")
    time.sleep(2)
    print(f"ç·šç¨‹ {threading.current_thread().name} å®Œæˆå·¥ä½œ")

# å‰µå»ºç·šç¨‹
thread = threading.Thread(target=worker)
thread.start()  # å•Ÿå‹•ç·šç¨‹
thread.join()   # ç­‰å¾…ç·šç¨‹å®Œæˆ

# å‰µå»ºå¤šå€‹ç·šç¨‹
threads = []
for i in range(3):
    t = threading.Thread(target=worker)
    threads.append(t)
    t.start()

# ç­‰å¾…æ‰€æœ‰ç·šç¨‹å®Œæˆ
for t in threads:
    t.join()
```

### 2. ç·šç¨‹é¡

```python
class WorkerThread(threading.Thread):
    def __init__(self, name):
        super().__init__()
        self.name = name
    
    def run(self):
        """ç·šç¨‹åŸ·è¡Œçš„æ–¹æ³•"""
        print(f"ç·šç¨‹ {self.name} é–‹å§‹å·¥ä½œ")
        time.sleep(2)
        print(f"ç·šç¨‹ {self.name} å®Œæˆå·¥ä½œ")

# ä½¿ç”¨ç·šç¨‹é¡
worker = WorkerThread("Worker-1")
worker.start()
worker.join()
```

## ç·šç¨‹åŒæ­¥

### 1. äº’æ–¥é–

```python
class Counter:
    def __init__(self):
        self.count = 0
        self.lock = threading.Lock()
    
    def increment(self):
        """å®‰å…¨çš„å¢åŠ è¨ˆæ•¸"""
        with self.lock:
            current = self.count
            time.sleep(0.1)  # æ¨¡æ“¬è€—æ™‚æ“ä½œ
            self.count = current + 1
    
    def get_count(self):
        """ç²å–ç•¶å‰è¨ˆæ•¸"""
        with self.lock:
            return self.count

# ä½¿ç”¨äº’æ–¥é–
counter = Counter()
threads = []

for _ in range(10):
    t = threading.Thread(target=counter.increment)
    threads.append(t)
    t.start()

for t in threads:
    t.join()

print(f"æœ€çµ‚è¨ˆæ•¸: {counter.get_count()}")
```

### 2. æ¢ä»¶è®Šé‡

```python
class Buffer:
    def __init__(self, size):
        self.buffer = []
        self.size = size
        self.condition = threading.Condition()
    
    def produce(self, item):
        """ç”Ÿç”¢è€…æ–¹æ³•"""
        with self.condition:
            while len(self.buffer) >= self.size:
                print("ç·©è¡å€å·²æ»¿ï¼Œç­‰å¾…æ¶ˆè²»...")
                self.condition.wait()
            
            self.buffer.append(item)
            print(f"ç”Ÿç”¢: {item}")
            self.condition.notify()
    
    def consume(self):
        """æ¶ˆè²»è€…æ–¹æ³•"""
        with self.condition:
            while len(self.buffer) == 0:
                print("ç·©è¡å€ç‚ºç©ºï¼Œç­‰å¾…ç”Ÿç”¢...")
                self.condition.wait()
            
            item = self.buffer.pop(0)
            print(f"æ¶ˆè²»: {item}")
            self.condition.notify()
            return item

# ä½¿ç”¨æ¢ä»¶è®Šé‡
buffer = Buffer(5)

def producer():
    for i in range(10):
        buffer.produce(i)
        time.sleep(0.5)

def consumer():
    for _ in range(10):
        buffer.consume()
        time.sleep(1)

# å‰µå»ºç”Ÿç”¢è€…å’Œæ¶ˆè²»è€…ç·šç¨‹
prod = threading.Thread(target=producer)
cons = threading.Thread(target=consumer)

prod.start()
cons.start()

prod.join()
cons.join()
```

## ç·šç¨‹é€šä¿¡

### 1. äº‹ä»¶

```python
class Worker:
    def __init__(self):
        self.event = threading.Event()
    
    def wait_for_event(self):
        """ç­‰å¾…äº‹ä»¶"""
        print("ç­‰å¾…äº‹ä»¶...")
        self.event.wait()
        print("äº‹ä»¶å·²è§¸ç™¼ï¼Œç¹¼çºŒåŸ·è¡Œ")
    
    def trigger_event(self):
        """è§¸ç™¼äº‹ä»¶"""
        print("è§¸ç™¼äº‹ä»¶")
        self.event.set()

# ä½¿ç”¨äº‹ä»¶
worker = Worker()

def waiter():
    worker.wait_for_event()

def trigger():
    time.sleep(2)
    worker.trigger_event()

# å‰µå»ºç­‰å¾…å’Œè§¸ç™¼ç·šç¨‹
wait_thread = threading.Thread(target=waiter)
trigger_thread = threading.Thread(target=trigger)

wait_thread.start()
trigger_thread.start()

wait_thread.join()
trigger_thread.join()
```

### 2. éšŠåˆ—

```python
from queue import Queue
import random

class TaskQueue:
    def __init__(self):
        self.queue = Queue()
    
    def producer(self):
        """ç”Ÿç”¢ä»»å‹™"""
        for i in range(5):
            task = f"Task-{i}"
            self.queue.put(task)
            print(f"ç”Ÿç”¢ä»»å‹™: {task}")
            time.sleep(random.random())
    
    def consumer(self):
        """æ¶ˆè²»ä»»å‹™"""
        while True:
            try:
                task = self.queue.get(timeout=3)
                print(f"è™•ç†ä»»å‹™: {task}")
                time.sleep(random.random())
                self.queue.task_done()
            except Queue.Empty:
                print("éšŠåˆ—ç‚ºç©ºï¼Œé€€å‡ºæ¶ˆè²»è€…")
                break

# ä½¿ç”¨ä»»å‹™éšŠåˆ—
task_queue = TaskQueue()

# å‰µå»ºç”Ÿç”¢è€…å’Œæ¶ˆè²»è€…ç·šç¨‹
producer_thread = threading.Thread(target=task_queue.producer)
consumer_thread = threading.Thread(target=task_queue.consumer)

producer_thread.start()
consumer_thread.start()

producer_thread.join()
consumer_thread.join()
```

## ç·šç¨‹æ± 

### 1. åŸºæœ¬ç·šç¨‹æ± 

```python
from concurrent.futures import ThreadPoolExecutor
import random

def process_task(task_id):
    """è™•ç†ä»»å‹™"""
    print(f"é–‹å§‹è™•ç†ä»»å‹™ {task_id}")
    time.sleep(random.random() * 2)  # æ¨¡æ“¬å·¥ä½œæ™‚é–“
    print(f"å®Œæˆä»»å‹™ {task_id}")
    return f"Task {task_id} result"

# ä½¿ç”¨ç·šç¨‹æ± 
with ThreadPoolExecutor(max_workers=3) as executor:
    # æäº¤å¤šå€‹ä»»å‹™
    futures = [executor.submit(process_task, i) for i in range(5)]
    
    # ç²å–çµæœ
    for future in futures:
        result = future.result()
        print(f"ç²å¾—çµæœ: {result}")
```

### 2. é€²åº¦å›èª¿

```python
from concurrent.futures import ThreadPoolExecutor, as_completed
from tqdm import tqdm

def process_with_progress(tasks):
    """å¸¶é€²åº¦æ¢çš„ä»»å‹™è™•ç†"""
    with ThreadPoolExecutor(max_workers=3) as executor:
        futures = [executor.submit(process_task, task) for task in tasks]
        
        with tqdm(total=len(tasks)) as pbar:
            for future in as_completed(futures):
                result = future.result()
                pbar.update(1)
                yield result

# ä½¿ç”¨å¸¶é€²åº¦çš„ç·šç¨‹æ± 
tasks = range(10)
results = list(process_with_progress(tasks))
print("æ‰€æœ‰ä»»å‹™å®Œæˆï¼")
```

## å¯¦éš›æ‡‰ç”¨ç¯„ä¾‹

### 1. ä¸¦è¡Œæ–‡ä»¶ä¸‹è¼‰å™¨

```python
import requests
from concurrent.futures import ThreadPoolExecutor
from urllib.parse import urlparse
import os

class ParallelDownloader:
    def __init__(self, max_workers=5):
        self.max_workers = max_workers
        self.executor = ThreadPoolExecutor(max_workers=max_workers)
    
    def download_file(self, url):
        """ä¸‹è¼‰å–®å€‹æ–‡ä»¶"""
        try:
            response = requests.get(url, stream=True)
            filename = os.path.basename(urlparse(url).path)
            
            with open(filename, 'wb') as f:
                for chunk in response.iter_content(chunk_size=8192):
                    if chunk:
                        f.write(chunk)
            
            return f"æˆåŠŸä¸‹è¼‰: {filename}"
        except Exception as e:
            return f"ä¸‹è¼‰å¤±æ•— {url}: {str(e)}"
    
    def download_files(self, urls):
        """ä¸¦è¡Œä¸‹è¼‰å¤šå€‹æ–‡ä»¶"""
        futures = []
        for url in urls:
            future = self.executor.submit(self.download_file, url)
            futures.append(future)
        
        results = []
        for future in as_completed(futures):
            results.append(future.result())
        
        return results

# ä½¿ç”¨ä¸¦è¡Œä¸‹è¼‰å™¨
urls = [
    "http://example.com/file1.pdf",
    "http://example.com/file2.pdf",
    "http://example.com/file3.pdf"
]

downloader = ParallelDownloader()
results = downloader.download_files(urls)
for result in results:
    print(result)
```

### 2. ç¶²é çˆ¬èŸ²

```python
import requests
from bs4 import BeautifulSoup
from concurrent.futures import ThreadPoolExecutor
from queue import Queue
import threading

class WebCrawler:
    def __init__(self, start_url, max_workers=3):
        self.start_url = start_url
        self.max_workers = max_workers
        self.visited = set()
        self.queue = Queue()
        self.lock = threading.Lock()
    
    def get_links(self, url):
        """ç²å–é é¢ä¸­çš„éˆæ¥"""
        try:
            response = requests.get(url)
            soup = BeautifulSoup(response.text, 'html.parser')
            return [a.get('href') for a in soup.find_all('a', href=True)]
        except:
            return []
    
    def process_page(self, url):
        """è™•ç†å–®å€‹é é¢"""
        if url in self.visited:
            return
        
        with self.lock:
            self.visited.add(url)
        
        print(f"æ­£åœ¨è™•ç†: {url}")
        links = self.get_links(url)
        
        for link in links:
            if link not in self.visited:
                self.queue.put(link)
    
    def crawl(self):
        """é–‹å§‹çˆ¬å–"""
        self.queue.put(self.start_url)
        
        with ThreadPoolExecutor(max_workers=self.max_workers) as executor:
            while True:
                try:
                    url = self.queue.get(timeout=3)
                    executor.submit(self.process_page, url)
                except Queue.Empty:
                    break

# ä½¿ç”¨ç¶²é çˆ¬èŸ²
crawler = WebCrawler("http://example.com")
crawler.crawl()
print(f"å·²è¨ªå• {len(crawler.visited)} å€‹é é¢")
```

## ç·´ç¿’é¡Œ

1. **ä¸¦è¡Œæ–‡ä»¶è™•ç†å™¨**
   å¯¦ç¾ä¸€å€‹ä¸¦è¡Œæ–‡ä»¶è™•ç†ç³»çµ±ï¼š
   - è®€å–å¤šå€‹æ–‡ä»¶
   - ä¸¦è¡Œè™•ç†å…§å®¹
   - åˆä½µè™•ç†çµæœ
   - ä¿å­˜è¼¸å‡ºæ–‡ä»¶

2. **ä»»å‹™èª¿åº¦å™¨**
   å‰µå»ºä¸€å€‹ä»»å‹™èª¿åº¦ç³»çµ±ï¼š
   - ä»»å‹™å„ªå…ˆç´š
   - å®šæ™‚åŸ·è¡Œ
   - éŒ¯èª¤é‡è©¦
   - é€²åº¦ç›£æ§

3. **ä¸¦è¡Œæ¸¬è©¦åŸ·è¡Œå™¨**
   é–‹ç™¼ä¸€å€‹ä¸¦è¡Œæ¸¬è©¦åŸ·è¡Œå™¨ï¼š
   - ä¸¦è¡Œé‹è¡Œæ¸¬è©¦
   - æ”¶é›†æ¸¬è©¦çµæœ
   - ç”Ÿæˆæ¸¬è©¦å ±å‘Š
   - éŒ¯èª¤è™•ç†

## å°æé†’ ğŸ’¡

1. åˆç†ä½¿ç”¨ç·šç¨‹æ•¸é‡
2. æ³¨æ„ç·šç¨‹å®‰å…¨
3. é¿å…æ­»é–æƒ…æ³
4. æ­£ç¢ºè™•ç†ç•°å¸¸
5. åŠæ™‚é‡‹æ”¾è³‡æº
6. ä½¿ç”¨é©ç•¶çš„åŒæ­¥æ©Ÿåˆ¶

[ä¸Šä¸€ç« ï¼šè³‡æ–™åº«æœ€ä½³å¯¦è¸](042_è³‡æ–™åº«æœ€ä½³å¯¦è¸.md) | [ä¸‹ä¸€ç« ï¼šå¤šç·šç¨‹é€²éš](044_å¤šç·šç¨‹é€²éš.md) 